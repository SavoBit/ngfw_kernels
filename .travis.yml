sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
      PACKAGE_SERVER_IP: 173.14.28.193
      REPOSITORY: buster
      PKGTOOLS_COMMIT: origin/${TRAVIS_BRANCH}
      UPLOAD: scp
  jobs:
    - ARCHITECTURE: amd64
    - ARCHITECTURE: i386

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_6d2b6653a2ab_key -iv $encrypted_6d2b6653a2ab_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: nS/5nvRBciBO5Lpe6fzjH8kF2S5eJbzRFxoewIpi50WXiZRpntNkaPCLWnnp1uPbGBBYHfCAq7n7cqz7Lv8Gr4JfFIHxpdiSTsUcepdPLkQHeeL8USLC0KAUEuuSESa3Wa8X03OG+rvaAULfJDlrOZy+l/4Sj/SEcI4NOCKITJkuHgR/HjyFNHqF2dL9WzzYz5IQ2PH8Uk4ffb2kAhaP271mWXAfkh0vjMncVxmddmf0YljCocZMZfGWDpH1Zqu2NF7UWMdKXeIeGYsCUNrN3mHyHAAOhehO5rYwkvLVlGN5aoiYB34o4MdvSISG8nD10kyBiC+4gP+AIvcDkp4hvCl+4GpzfOE2j7N2mDEdBpejBvfyaczTJ4wJB84dwc4qOXOs/NyVYTo1hjNjlapo+HsidkSD6J8Kflhk4iPt89W1BYCkrou4NUq9Cw7xViMTYXXzvw6l8FhGqvls9RcOHI+11cqQjaG2qtvVG1x/DZaOWtB4pUonAJu6Q+eqZnO9G/KMxHh+Nl9TTEEonsKmClDu7HAtAUpiRGG4P+GaLdf80vAPy3jLiu6yc7m+NAGYj4b32/SoVilrUoU12UL7R4Sor7MCyKpB68kHYMP/pomxlNloXyD5Zm1v2sCMJpH7cYOMftkQUlPST6+q4RE02aGHkjxvCOobYZ8i2O1LCb0=
    on_success: change
    on_failure: always
