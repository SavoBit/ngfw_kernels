From 8cdf2fb1e3b762036c59c8ae35035321ff3e2bcf Mon Sep 17 00:00:00 2001
From: Igor Grinberg <grinberg@compulab.co.il>
Date: Sun, 24 Feb 2013 18:16:11 +0200
Subject: ARM: i.MX6: cm-fx6: remove MIPI DSI board glue

Remove MX6_ARM2 specific MIPI DSI board glue.

Signed-off-by: Igor Grinberg <grinberg@compulab.co.il>
---
 arch/arm/mach-mx6/board-cm-fx6-dl.h |    8 ---
 arch/arm/mach-mx6/board-cm-fx6-q.h  |    8 ---
 arch/arm/mach-mx6/board-cm-fx6.c    |  124 +----------------------------------
 3 files changed, 1 insertion(+), 139 deletions(-)

diff --git a/arch/arm/mach-mx6/board-cm-fx6-dl.h b/arch/arm/mach-mx6/board-cm-fx6-dl.h
index 3dc0449..00eb1b9 100644
--- a/arch/arm/mach-mx6/board-cm-fx6-dl.h
+++ b/arch/arm/mach-mx6/board-cm-fx6-dl.h
@@ -120,8 +120,6 @@ static iomux_v3_cfg_t mx6dl_arm2_pads[] = {
 	MX6DL_PAD_DISP0_DAT22__IPU1_DISP0_DAT_22,
 	MX6DL_PAD_DISP0_DAT23__IPU1_DISP0_DAT_23,
 
-	MX6DL_PAD_EIM_D24__GPIO_3_24,
-
 	/* UART2 */
 	MX6DL_PAD_EIM_D26__UART2_RXD,
 	MX6DL_PAD_EIM_D27__UART2_TXD,
@@ -129,12 +127,6 @@ static iomux_v3_cfg_t mx6dl_arm2_pads[] = {
 	/* PWM1 */
 	MX6DL_PAD_GPIO_9__PWM1_PWMO,
 
-	/* DISP0 DET */
-	MX6DL_PAD_EIM_D31__GPIO_3_31,
-
-	/* DISP0 RESET */
-	MX6DL_PAD_EIM_WAIT__GPIO_5_0,
-
 	/* HDMI */
 	MX6DL_PAD_EIM_A25__HDMI_TX_CEC_LINE,
 	MX6DL_PAD_SD1_DAT1__HDMI_TX_OPHYDTB_0,
diff --git a/arch/arm/mach-mx6/board-cm-fx6-q.h b/arch/arm/mach-mx6/board-cm-fx6-q.h
index bbf7729..727e6e1 100644
--- a/arch/arm/mach-mx6/board-cm-fx6-q.h
+++ b/arch/arm/mach-mx6/board-cm-fx6-q.h
@@ -120,8 +120,6 @@ static iomux_v3_cfg_t mx6q_arm2_pads[] = {
 	MX6Q_PAD_DISP0_DAT22__IPU1_DISP0_DAT_22,
 	MX6Q_PAD_DISP0_DAT23__IPU1_DISP0_DAT_23,
 
-	MX6Q_PAD_EIM_D24__GPIO_3_24,
-
 	/* UART2 */
 	MX6Q_PAD_EIM_D26__UART2_RXD,
 	MX6Q_PAD_EIM_D27__UART2_TXD,
@@ -129,12 +127,6 @@ static iomux_v3_cfg_t mx6q_arm2_pads[] = {
 	/* PWM1 */
 	MX6Q_PAD_GPIO_9__PWM1_PWMO,
 
-	/* DISP0 DET */
-	MX6Q_PAD_EIM_D31__GPIO_3_31,
-
-	/* DISP0 RESET */
-	MX6Q_PAD_EIM_WAIT__GPIO_5_0,
-
 	/* HDMI */
 	MX6Q_PAD_EIM_A25__HDMI_TX_CEC_LINE,
 	MX6Q_PAD_SD1_DAT1__HDMI_TX_OPHYDTB_0,
diff --git a/arch/arm/mach-mx6/board-cm-fx6.c b/arch/arm/mach-mx6/board-cm-fx6.c
index c128025..f4f2550 100644
--- a/arch/arm/mach-mx6/board-cm-fx6.c
+++ b/arch/arm/mach-mx6/board-cm-fx6.c
@@ -60,7 +60,6 @@
 #include <mach/ipu-v3.h>
 #include <mach/mxc_hdmi.h>
 #include <mach/mxc_asrc.h>
-#include <mach/mipi_dsi.h>
 
 #include <asm/irq.h>
 #include <asm/setup.h>
@@ -77,15 +76,12 @@
 
 /* GPIO PIN, sort by PORT/BIT */
 #define CM_FX6_GREEN_LED		IMX_GPIO_NR(2, 31)
+
 #define MX6_ARM2_LDB_BACKLIGHT		IMX_GPIO_NR(1, 9)
 #define MX6_ARM2_ECSPI1_CS0		IMX_GPIO_NR(2, 30)
 #define MX6_ARM2_ECSPI1_CS1		IMX_GPIO_NR(3, 19)
 #define MX6_ARM2_USB_OTG_PWR		IMX_GPIO_NR(3, 22)
-#define MX6_ARM2_DISP0_PWR		IMX_GPIO_NR(3, 24)
-#define MX6_ARM2_DISP0_I2C_EN		IMX_GPIO_NR(3, 28)
 #define MX6_ARM2_CAP_TCH_INT		IMX_GPIO_NR(3, 31)
-#define MX6_ARM2_DISP0_DET_INT		IMX_GPIO_NR(3, 31)
-#define MX6_ARM2_DISP0_RESET		IMX_GPIO_NR(5, 0)
 #define MX6_ARM2_CAN2_EN		IMX_GPIO_NR(5, 24)
 #define MX6_ARM2_SD3_CD			IMX_GPIO_NR(6, 11)
 #define MX6_ARM2_SD3_WP			IMX_GPIO_NR(6, 14)
@@ -101,7 +97,6 @@ void __init early_console_setup(unsigned long base, struct clk *clk);
 static struct clk *sata_clk;
 static int spdif_en;
 static int flexcan_en;
-static int disable_mipi_dsi;
 
 extern struct regulator *(*get_cpu_regulator)(void);
 extern void (*put_cpu_regulator)(void);
@@ -342,63 +337,6 @@ static void spi_device_init(void)
 				ARRAY_SIZE(cm_fx6_spi0_board_info));
 }
 
-static void ddc_dvi_init(void)
-{
-	/* enable DVI I2C */
-	gpio_set_value(MX6_ARM2_DISP0_I2C_EN, 1);
-
-	/* DISP0 Detect */
-	gpio_request(MX6_ARM2_DISP0_DET_INT, "disp0-detect");
-	gpio_direction_input(MX6_ARM2_DISP0_DET_INT);
-}
-
-static int ddc_dvi_update(void)
-{
-	/* DVI cable state */
-	if (gpio_get_value(MX6_ARM2_DISP0_DET_INT) == 1)
-		return 1;
-	return 0;
-}
-
-static struct fsl_mxc_dvi_platform_data sabr_ddc_dvi_data = {
-	.ipu_id		= 0,
-	.disp_id	= 0,
-	.init		= ddc_dvi_init,
-	.update		= ddc_dvi_update,
-};
-
-static int sii902x_get_pins(void)
-{
-	/* Sii902x HDMI controller */
-	gpio_request(MX6_ARM2_DISP0_RESET, "disp0-reset");
-	gpio_direction_output(MX6_ARM2_DISP0_RESET, 0);
-	gpio_request(MX6_ARM2_DISP0_DET_INT, "disp0-detect");
-	gpio_direction_input(MX6_ARM2_DISP0_DET_INT);
-	return 1;
-}
-
-static void sii902x_put_pins(void)
-{
-	gpio_free(MX6_ARM2_DISP0_RESET);
-	gpio_free(MX6_ARM2_DISP0_DET_INT);
-}
-
-static void sii902x_hdmi_reset(void)
-{
-       gpio_set_value(MX6_ARM2_DISP0_RESET, 0);
-       msleep(10);
-       gpio_set_value(MX6_ARM2_DISP0_RESET, 1);
-       msleep(10);
-}
-
-static struct fsl_mxc_lcd_platform_data sii902x_hdmi_data = {
-	.ipu_id = 0,
-	.disp_id = 0,
-	.reset = sii902x_hdmi_reset,
-	.get_pins = sii902x_get_pins,
-	.put_pins = sii902x_put_pins,
-};
-
 static struct imxi2c_platform_data mx6_arm2_i2c0_data = {
 	.bitrate = 100000,
 };
@@ -413,17 +351,10 @@ static struct imxi2c_platform_data mx6_arm2_i2c2_data = {
 
 static struct i2c_board_info mxc_i2c1_board_info[] __initdata = {
 	{
-//		I2C_BOARD_INFO("mxc_dvi", 0x50),
-//		.platform_data = &sabr_ddc_dvi_data,
-//		.irq = gpio_to_irq(MX6_ARM2_DISP0_DET_INT),
 		I2C_BOARD_INFO("mxc_hdmi_i2c", 0x50),
 //	}, {
 //		I2C_BOARD_INFO("egalax_ts", 0x4),
 //		.irq = gpio_to_irq(MX6_ARM2_CAP_TCH_INT),
-//	}, {
-//		I2C_BOARD_INFO("sii902x", 0x39),
-//		.platform_data = &sii902x_hdmi_data,
-//		.irq = gpio_to_irq(MX6_ARM2_DISP0_DET_INT),
 	},
 };
 
@@ -562,28 +493,6 @@ static struct imx_asrc_platform_data imx_asrc_data = {
 	.clk_map_ver	= 2,
 };
 
-static void mx6_arm2_reset_mipi_dsi(void)
-{
-	gpio_set_value(MX6_ARM2_DISP0_PWR, 1);
-	gpio_set_value(MX6_ARM2_DISP0_RESET, 1);
-	udelay(10);
-	gpio_set_value(MX6_ARM2_DISP0_RESET, 0);
-	udelay(50);
-	gpio_set_value(MX6_ARM2_DISP0_RESET, 1);
-
-	/*
-	 * it needs to delay 120ms minimum for reset complete
-	 */
-	msleep(120);
-}
-
-static struct mipi_dsi_platform_data mipi_dsi_pdata = {
-	.ipu_id		= 1,
-	.disp_id	= 1,
-	.lcd_panel	= "TRULY-WVGA",
-	.reset		= mx6_arm2_reset_mipi_dsi,
-};
-
 static struct ipuv3_fb_platform_data sabr_fb_data[] = {
 	{ /*fb0*/
 	.disp_dev		= "ldb",
@@ -592,12 +501,6 @@ static struct ipuv3_fb_platform_data sabr_fb_data[] = {
 	.default_bpp		= 16,
 	.int_clk		= false,
 	}, {
-	.disp_dev		= "mipi_dsi",
-	.interface_pix_fmt	= IPU_PIX_FMT_RGB24,
-	.mode_str		= "TRULY-WVGA",
-	.default_bpp		= 24,
-	.int_clk		= false,
-	}, {
 	.disp_dev		= "ldb",
 	.interface_pix_fmt	= IPU_PIX_FMT_RGB666,
 	.mode_str		= "LDB-XGA",
@@ -863,15 +766,6 @@ static const struct imx_pcie_platform_data mx6_arm2_pcie_data  __initconst = {
 	.pcie_dis	= -EINVAL,
 };
 
-static int __init early_disable_mipi_dsi(char *p)
-{
-	/*enable on board HDMI*/
-	/*mulplex pin with mipi disp0_reset we should disable mipi reset*/
-	disable_mipi_dsi = 1;
-	return 0;
-}
-early_param("disable_mipi_dsi", early_disable_mipi_dsi);
-
 #if defined(CONFIG_LEDS_GPIO) || defined(CONFIG_LEDS_GPIO_MODULE)
 static struct gpio_led cm_fx6_leds[] = {
 	[0] = {
@@ -991,8 +885,6 @@ static void __init cm_fx6_init(void)
 		imx6q_add_ipuv3(1, &ipu_data[1]);
 
 	if (cpu_is_mx6dl()) {
-		mipi_dsi_pdata.ipu_id = 0;
-		mipi_dsi_pdata.disp_id = 1;
 		ldb_data.ipu_id = 0;
 		ldb_data.disp_id = 0;
 		for (i = 0; i < ARRAY_SIZE(sabr_fb_data) / 2; i++)
@@ -1002,8 +894,6 @@ static void __init cm_fx6_init(void)
 			imx6q_add_ipuv3fb(i, &sabr_fb_data[i]);
 	}
 
-	if (!disable_mipi_dsi)
-		imx6q_add_mipi_dsi(&mipi_dsi_pdata);
 	imx6q_add_vdoa();
 	imx6q_add_lcdif(&lcdif_data);
 	imx6q_add_ldb(&ldb_data);
@@ -1018,8 +908,6 @@ static void __init cm_fx6_init(void)
 	i2c_register_board_info(1, mxc_i2c1_board_info,
 			ARRAY_SIZE(mxc_i2c1_board_info));
 	if (!spdif_en) {
-		if (disable_mipi_dsi)
-			mx6_arm2_i2c2_data.bitrate = 100000;
 		imx6q_add_imx_i2c(2, &mx6_arm2_i2c2_data);
 		i2c_register_board_info(2, cm_fx6_i2c2_board_info,
 				ARRAY_SIZE(cm_fx6_i2c2_board_info));
@@ -1053,16 +941,6 @@ static void __init cm_fx6_init(void)
 	imx_asrc_data.asrc_audio_clk = clk_get(NULL, "asrc_serial_clk");
 	imx6q_add_asrc(&imx_asrc_data);
 
-	/* DISP0 Reset - Assert for i2c disabled mode */
-	gpio_request_one(MX6_ARM2_DISP0_RESET, GPIOF_OUT_INIT_LOW,
-			 "disp0-reset");
-
-	/* DISP0 I2C enable */
-	if (!disable_mipi_dsi)
-		gpio_request_one(MX6_ARM2_DISP0_I2C_EN, GPIOF_OUT_INIT_LOW,
-				 "disp0-i2c");
-
-	gpio_request_one(MX6_ARM2_DISP0_PWR, GPIOF_OUT_INIT_HIGH, "disp0-pwr");
 	gpio_request_one(MX6_ARM2_LDB_BACKLIGHT, GPIOF_OUT_INIT_HIGH,
 			 "ldb-backlight");
 	imx6q_add_otp();
-- 
1.7.9.5

